System Design социальной сети

Функциональные требования
	1. публикация постов
		- Добавление фотографии к посту
		- Добавление геометки
		- Добавление текстового описания
	2. Оценки и комментарии
		- Лайки постов
		- Возможность комменировать посты
		- Комментарии постов
			- Выдача комментариев с пагинацией
			- Видно имя пользователя в комментарии
			- Виден текст комментариях
			- Без ветвения
			- Без сортировки комментариев
			- Без лайков комментариев
			- Без возможности отвечать на комментарии других пользователей
			- Без возможности вызывать пользователей в комментариях
			- Без аватара автора комментария
	3. Подписка на других пользователей
		- Возможность отменить подписку
	4. Лента постов
		- Выдача с пагинацией
		- Общая лента
			- Сортировка по дате добавления: по убыванию
		- Лента подписок
			- Сортировка по дате добавления: по убыванию
	5. Поиск постов
		- Поиск по геометке
		- Поиск по строке
		- Выдача с пагинацией
		
Нефункциональные требования:
Общее
	1. DAU: 10 000 000
	2. Регион: страны СНГ
	3. Сезонность: середина мая - середина сентября, новогодние праздники
	4. Данные храним всегда
	5. Доступность 99% (в идеале 95%, раз уж я представляю разработку)
 
Лимиты и ограничения:
	1. Количество отображаемых постов на страницы во всех лентах: 10
	2. Количество отображаемых комментариев под постом на одной странице: 30
	3. Количество подписок у одного пользователя: 1000
	4. Максимальный размер загружаемой фотографии: 2mb
	5. Разрешенные форматы фотографий : JPEG, PNG, WebP
	6. Разрешенное параметры изображения: отношение сторон не меньше 1/3, размер любой стороны не больше 4000px и не меньше 360px
	7. Максимальное количество изображений в посте: 5
	8. Максимальное количество символов в посте: 3000
	9. Максимальное количество подписчиков у одного пользователя: 100000
	10. Без ограничения количества постов или лайков в день, но лимит rps на запись на юзера = 1
	11. Максимальное количество символов в комментарии 500
	
 Оценка нагрузки.
	За основу взята статистику пикабу за октябрь 2024
	https://pikabu.ru/story/pikabu_itogi_oktyabrya_2024_g_12048759
	https://special.pikabu.ru/mediakit
	DAU - 3 000 000
	
Коээффициент отличия DAU от нашего сервиса: 3.33
		
Т.к. есть информация по среднему распределению публикации постов по часам,
	то можем приблизительно узнать средний RPS в прайм тайм. 
	https://pikabu.ru/story/logika_pikabu_ili_analiz_statistiki_postov_za_4_nedeli_4348954
	Общее количество постов в сутки в графике: 17650
	Максимальное количество постов в час: 1200
	Максимальный rps публикации постов исходя из графика: ~7% от суточного RPS в час
	
RPS при равномерно распределенной нагрузке
	1. Создание постов: 110656 * 3.33 / 30 / 86400 ~ **0.14**
	2. Создание комментариев:  3754681 * 3.33 / 30 / 86400 ~ **4.8**
	3. Просмотр постов: 2236649217 * 3.33  / 30 / 86400 ~ **2873.4**
	
RPS на основе "реальных" данных о нагрузке
	1. Создание постов: 110656 * 3.33 / 30 * 0.07 / 3600 ~ **0.23**
	2. Создание комментариев:  3754681 * 3.33 / 30 * 0.07 / 3600 ~ **8.1**
	3. Просмотр постов: 2236649217 * 3.33 / 30 * 0.07 / 3600 ~ **4827**
	
Средний траффик на основе "реальных" данных:
	1. Один пост:
		- 3 изображения среднего качества* = 2250kb
		- на 50% заполненный блок description ~ 1.5kb
		- дополнительная мета информация ~ 0.05kb
		итог = 2 256 000 b
	2. Один комментарий: 
		- 120 символов* ~ 200b
		- дополнительная мета информация ~ 50b
		итог: 250b
		
*Среднее качество фото 500-1000kb для jpeg (https://www.quora.com/What-is-the-average-size-of-an-image)
*Средняя длина комментария на DTF (https://dtf.ru/flood/651236-analiz-kommentariev-za-nachalo-2021-klassovaya-borba)
	
Для расчета количество комментариев возьмем условно чтение одного комментария на 1 пост.
	Объяснение: 10% пользователей "проваливаются" внутрь поста из ленты, где видит 10 первых комментариев.
	
Траффик:
	При равномерно распределенной нагрузке:
	1. Создание постов: 0.14 * 2256000 = 315840 байт/с
	2. Создание комментариев:  4.8 * 200 = 960 байт/с
	3. Просмотр постов: 2873.4 * 2256000 = 6482390400 байт/с
	4. Просмотр комментариев: 2873.4 * 200 = 574680 байт/с
	Итог: 6483281880 байт/с  или 6483,28188 мб/с или **51866,25504** Мбит/c
	
При реальной нагрузке
	1. Создание постов: 0.23 * 2256000 = 518880 байт/с
	2. Создание комментариев:  8.1 * 200 = 1620 байт/с
	3. Просмотр постов: 4827 * 2256000 = 10889712000 байт/с
	4. Просмотр комментариев: 2873.4 * 200 = 574680 байт/с
	
Итог: 10890807180 байт/с  или 10890,80718 мб/с **87126,45744** Мбит/c
